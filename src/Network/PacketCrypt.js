/**
 * NetWork/PacketCrypt.js
 *
 * Encrypt packets with defined keys
 * It's an official features used in the Hercules emulator. As some servers may used it it has
 * to be implement in roBrowser.
 *
 * Source: http://hercules.ws/board/topic/1105-hercules-wpe-free-june-14th-patch/
 *
 * To enable it, you have to set the parameter "packetKeys" in the ROConfig array :
 * - If set to true, the client will use the packetver used by roBrowser to find its keys (check the KeysTable list behind)
 * - If set to a date (ex: 20120111), roBrowser will use the keys related to this version.
 * - If set to an array (ex: [0x053D5CED,0x3DED6DED,0x6DED6DED]), roBrowser will use the keys specified.
 *
 * This file is part of ROBrowser, (http://www.robrowser.com/).
 *
 * @author Vincent Thibault
 */

import Configs from "../Core/Configs.js";

/**
 * @var {integer} Keys to shuffle the packet
 */
var _keys = new Uint32Array(3);

/**
 * @var {boolean} is encryption available ?
 */
var _available = false;

/**
 * @var {List} date => encryption keys
 */
var KeysTable = {
	20101123: [0x49357d72, 0x22c370a1, 0x5f836591],
	20101124: [0x49357d72, 0x22c370a1, 0x5f836591],
	20101126: [0x49357d72, 0x22c370a1, 0x5f836591],
	20101130: [0x3726593c, 0x0efd5ee8, 0x79036df9],
	20101207: [0x66111112, 0x2b7b53aa, 0x04e76df8],
	20101214: [0x5e535d06, 0x4e297f0e, 0x400b6ad8],
	20101221: [0x0448466a, 0x41554ac9, 0x5b4710b2],
	20101228: [0x50c638a5, 0x4bf86b20, 0x480c3746],
	20110104: [0x55db401f, 0x047d4e02, 0x6d8f2ea3],
	20110111: [0x2d5f6302, 0x2a361cd6, 0x39d661d6],
	20110118: [0x3c777d2d, 0x00541a1d, 0x5e0053a2],
	20110125: [0x6bb84bb0, 0x4c004382, 0x10ae3260],
	20110126: [0x6bb84bb0, 0x4c004382, 0x10ae3260],
	20110131: [0x6bb84bb0, 0x4c004382, 0x10ae3260],
	20110131: [0x68871e62, 0x60d17266, 0x74726daa],
	20110201: [0x68871e62, 0x60d17266, 0x74726daa],
	20110208: [0x72ba4e9d, 0x281e1df1, 0x208255aa],
	20110210: [0x72ba4e9d, 0x281e1df1, 0x208255aa],
	20110215: [0x1b174d76, 0x32005014, 0x7b8b72d5],
	20110222: [0x48f73b56, 0x155f7d66, 0x44ab57ce],
	20110223: [0x48f73b56, 0x155f7d66, 0x44ab57ce],
	20110224: [0x48f73b56, 0x155f7d66, 0x44ab57ce],
	20110225: [0x48f73b56, 0x155f7d66, 0x44ab57ce],
	20110228: [0x26385ebf, 0x7a8c7534, 0x60ae2c34],
	20110308: [0x003f1b20, 0x7a1e12a3, 0x34994aad],
	20110309: [0x003f1b20, 0x7a1e12a3, 0x34994aad],
	20110315: [0x62967d7d, 0x34833d1a, 0x26d45eca],
	20110316: [0x62967d7d, 0x34833d1a, 0x26d45eca],
	20110322: [0x5870617c, 0x638d5376, 0x739f4817],
	20110329: [0x06900bb7, 0x45db687b, 0x197b017b],
	20110330: [0x06900bb7, 0x45db687b, 0x197b017b],
	20110405: [0x248d5c37, 0x1c6a1b37, 0x1f644fdb],
	20110412: [0x3de86bfc, 0x0dd47f80, 0x42481c9b],
	20110419: [0x26073204, 0x62013a51, 0x22ac58e0],
	20110426: [0x392813f9, 0x09905054, 0x40db732e],
	20110503: [0x28be32ee, 0x1d506fcb, 0x63832421],
	20110511: [0x6a715733, 0x3c5c0d74, 0x408a48ec],
	20110517: [0x07fe0c72, 0x46766bad, 0x5eb5126a],
	20110523: [0x69166916, 0x69166916, 0x69166916],
	20110526: [0x69166916, 0x69166916, 0x69166916],
	20110531: [0x5aba2c7c, 0x3cd22073, 0x78953988],
	20110607: [0x76b0426c, 0x0dd74deb, 0x1f92228e],
	20110608: [0x76b0426c, 0x0dd74deb, 0x1f92228e],
	20110609: [0x76b0426c, 0x0dd74deb, 0x1f92228e],
	20110614: [0x5749027b, 0x71710972, 0x5b096475],
	20110620: [0x3a1760d4, 0x254e0df9, 0x440e2357],
	20110627: [0x3efc29bd, 0x699e4b11, 0x7b900a13],
	20110705: [0x48801a5e, 0x68fc7726, 0x081d7f6e],
	20110711: [0x489c544b, 0x33ba1c25, 0x2de66e4e],
	20110713: [0x489c544b, 0x33ba1c25, 0x2de66e4e],
	20110718: [0x08464674, 0x1eeb3bd5, 0x33395199],
	20110726: [0x41e5730b, 0x119c6c11, 0x5356524a],
	20110802: [0x607c08a1, 0x65b20528, 0x360571e9],
	20110809: [0x742a559a, 0x047f425d, 0x5c8c2ca0],
	20110816: [0x053d5ced, 0x3ded6ded, 0x6ded6ded],
	20110817: [0x053d5ced, 0x3ded6ded, 0x6ded6ded],
	20110823: [0x35c91401, 0x262a5556, 0x28fa03aa],
	20110824: [0x35c91401, 0x262a5556, 0x28fa03aa],
	20110831: [0x3ad67ed0, 0x44703c69, 0x6f876809],
	20110906: [0x350124ec, 0x39a14595, 0x0de56125],
	20110914: [0x350124ec, 0x39a14595, 0x0de56125],
	20110920: [0x79c91a12, 0x20450cc0, 0x584b2a38],
	20110928: [0x26567512, 0x4b0732df, 0x57d266c6],
	20110929: [0x26567512, 0x4b0732df, 0x57d266c6],
	20111004: [0x291e6762, 0x77cd391a, 0x60ac2f16],
	20111005: [0x291e6762, 0x77cd391a, 0x60ac2f16],
	20111010: [0x7f3c2d29, 0x59b01de6, 0x1dbb44ca],
	20111012: [0x7f3c2d29, 0x59b01de6, 0x1dbb44ca],
	20111017: [0x357d55dc, 0x5a8d759f, 0x245c30f5],
	20111019: [0x357d55dc, 0x5a8d759f, 0x245c30f5],
	20111021: [0x357d55dc, 0x5a8d759f, 0x245c30f5],
	20111025: [0x50ae1a63, 0x3ce579b5, 0x29c10406],
	20111101: [0x5324329d, 0x5d545d52, 0x06137269],
	20111102: [0x5324329d, 0x5d545d52, 0x06137269],
	20111108: [0x0b642bda, 0x6ecb1d1c, 0x61c7454b],
	20111109: [0x0b642bda, 0x6ecb1d1c, 0x61c7454b],
	20111114: [0x419d0db0, 0x74916bf4, 0x027371b4],
	20111116: [0x419d0db0, 0x74916bf4, 0x027371b4],
	20111122: [0x3b550f07, 0x1f666c7c, 0x60304ef5],
	20111123: [0x3b550f07, 0x1f666c7c, 0x60304ef5],
	20111207: [0x2a610886, 0x3e09165e, 0x57c11888],
	20111213: [0x5151306b, 0x7ae32886, 0x53060628],
	20111214: [0x5151306b, 0x7ae32886, 0x53060628],
	20111220: [0x05d53871, 0x7d0027b4, 0x29975333],
	20111227: [0x0ff87e93, 0x6cff7860, 0x3a3d1dec],
	20111228: [0x0ff87e93, 0x6cff7860, 0x3a3d1dec],
	20120103: [0x262034a1, 0x674542a5, 0x73a50ba5],
	20120104: [0x262034a1, 0x674542a5, 0x73a50ba5],
	20120110: [0x2b412afc, 0x4ff94487, 0x6705339d],
	20120111: [0x2b412afc, 0x4ff94487, 0x6705339d],
	20120117: [0x24e32c2e, 0x48dd17a5, 0x64f8771a],
	20120118: [0x24e32c2e, 0x48dd17a5, 0x64f8771a],
	20120120: [0x504345d0, 0x3d427b1b, 0x794c2dcc],
	20120131: [0x2cfc0a71, 0x2ba91d8d, 0x087e39e0],
	20120201: [0x2cfc0a71, 0x2ba91d8d, 0x087e39e0],
	20120202: [0x2cfc0a71, 0x2ba91d8d, 0x087e39e0],
	20120207: [0x1d373f5d, 0x5acd604d, 0x1c4d7c4d],
	20120208: [0x1d373f5d, 0x5acd604d, 0x1c4d7c4d],
	20120209: [0x1d373f5d, 0x5acd604d, 0x1c4d7c4d],
	20120214: [0x7a255efa, 0x30977276, 0x2d4a0448],
	20120215: [0x7a255efa, 0x30977276, 0x2d4a0448],
	20120221: [0x1ca5130f, 0x43ed240a, 0x7fea3be0],
	20120222: [0x1ca5130f, 0x43ed240a, 0x7fea3be0],
	20120228: [0x520b4c64, 0x2800407d, 0x47651458],
	20120229: [0x520b4c64, 0x2800407d, 0x47651458],
	20120307: [0x382a6def, 0x5cbe7202, 0x61f46637],
	20120314: [0x689c1729, 0x11812639, 0x60f82967],
	20120320: [0x21f9683f, 0x710c5ca5, 0x1fd910e9],
	20120321: [0x21f9683f, 0x710c5ca5, 0x1fd910e9],
	20120328: [0x75b8553b, 0x37f20b12, 0x385c2b40],
	20120404: [0x0036310c, 0x2dcd0bed, 0x1ee62a78],
	20120410: [0x01581359, 0x452d6ffa, 0x6afb6e2e],
	20120417: [0x01540e48, 0x13041224, 0x31247924],
	20120418: [0x01540e48, 0x13041224, 0x31247924],
	20120424: [0x411d1dbb, 0x4cba4848, 0x1a432fc4],
	20120502: [0x37a91d19, 0x10190019, 0x00190019],
	20120503: [0x37a91d19, 0x10190019, 0x00190019],
	20120508: [0x16cf3301, 0x1f472b9b, 0x0b4a3cd2],
	20120509: [0x16cf3301, 0x1f472b9b, 0x0b4a3cd2],
	20120515: [0x4a715ef9, 0x79103e4f, 0x405c1238],
	20120522: [0x70eb4ccb, 0x0487713c, 0x398d4b08],
	20120523: [0x70eb4ccb, 0x0487713c, 0x398d4b08],
	20120525: [0x70eb4ccb, 0x0487713c, 0x398d4b08],
	20120529: [0x53415dde, 0x34953e16, 0x27623df2],
	20120601: [0x68ca3080, 0x31b74bdd, 0x505208f1],
	20120604: [0x68ca3080, 0x31b74bdd, 0x505208f1],
	20120605: [0x68ca3080, 0x31b74bdd, 0x505208f1],
	20120612: [0x32e45d64, 0x35643564, 0x35643564],
	20120618: [0x261f261f, 0x261f261f, 0x261f261f],
	20120626: [0x02277e66, 0x045723f1, 0x7107392c],
	20120627: [0x02277e66, 0x045723f1, 0x7107392c],
	20120702: [0x25733b31, 0x53486cfd, 0x398649bd],
	20120710: [0x0e8b7afb, 0x6930362d, 0x42d33a57],
	20120712: [0x0e8b7afb, 0x6930362d, 0x42d33a57],
	20120716: [0x76052205, 0x22052205, 0x22052205],
	20120724: [0x783d5bc6, 0x3aac2176, 0x66616f02],
	20120801: [0x71fb6768, 0x5843166b, 0x6cb445c6],
	20120808: [0x5d5068bb, 0x36732065, 0x47cf7367],
	20120814: [0x203e21bd, 0x047459fb, 0x56af5a97],
	20120822: [0x06a92e7b, 0x3d324f29, 0x5fd63004],
	20120830: [0x0af1363d, 0x4ab33e3b, 0x48421dbe],
	20120905: [0x04f50d80, 0x092f5c4d, 0x29bf3dcf],
	20120911: [0x1f3d1145, 0x02db3c32, 0x4be34c49],
	20120919: [0x72e00f24, 0x4ea02d80, 0x7c803480],
	20120925: [0x43a66e22, 0x36c2229f, 0x08172ece],
	20120926: [0x43a66e22, 0x36c2229f, 0x08172ece],
	20121010: [0x169733e2, 0x4c4640dc, 0x31636531],
	20121011: [0x169733e2, 0x4c4640dc, 0x31636531],
	20121017: [0x340c0c31, 0x33205ea8, 0x55964bff],
	20121024: [0x6166335c, 0x45393483, 0x7edc5478],
	20121031: [0x66eb7adb, 0x242864bb, 0x354a4cde],
	20121107: [0x49967892, 0x48025276, 0x1e192ca3],
	20121114: [0x3473545c, 0x2706445c, 0x79647616],
	20121121: [0x6eb54b0b, 0x3f2a6be5, 0x0b2866e6],
	20121128: [0x146d4d5e, 0x5c3d161b, 0x759250b8],
	20121205: [0x218c64b6, 0x4efe17ae, 0x27ea5e74],
	20121212: [0x7f8026f0, 0x32ee2a4b, 0x73746c0e],
	20121218: [0x6a5450a2, 0x4322498a, 0x2c6574fb],
	20121227: [0x71773018, 0x36a14eeb, 0x28cd5a20],
	20130103: [0x1e1a559a, 0x199a799a, 0x799a799a],
	20130107: [0x1e1a559a, 0x199a799a, 0x799a799a],
	20130109: [0x6435360f, 0x0a283678, 0x64a04ac7],
	20130115: [0x273c25cd, 0x06aa48af, 0x45a01bd4],
	20130116: [0x273c25cd, 0x06aa48af, 0x45a01bd4],
	20130121: [0x5dd874b0, 0x7d98233f, 0x28ff5566],
	20130130: [0x1ea57961, 0x27786856, 0x30301fa0],
	20130206: [0x1d8f4227, 0x675812aa, 0x29132929],
	20130215: [0x69fb1c38, 0x7d386860, 0x62805311],
	20130220: [0x0d555256, 0x28c26722, 0x72220a22],
	20130227: [0x44f86842, 0x43786a7a, 0x71654528],
	20130306: [0x7e274326, 0x7d182df2, 0x4fc27dfa],
	20130313: [0x560021c3, 0x6a5d110f, 0x52bd40a5],
	20130320: [0x3f094c49, 0x55f86c1e, 0x58aa359a],
	20130327: [0x114b1ba0, 0x2c4f0ae2, 0x5fa1183f],
	20130403: [0x424a43ae, 0x4a9d5ebe, 0x4b3518a9],
	20130410: [0x3ad52aca, 0x314d1aed, 0x086e415e],
	20130417: [0x7fb13b83, 0x6e003749, 0x07a02b94],
	20130424: [0x79f679f6, 0x79f679f6, 0x79f679f6],
	20130502: [0x62e733b9, 0x62204281, 0x7f044dca],
	20130508: [0x25421e49, 0x175200ba, 0x6c0b5239],
	20130514: [0x75794a38, 0x58a96bc1, 0x296e6fb8],
	20130515: [0x75794a38, 0x58a96bc1, 0x296e6fb8],
	20130522: [0x6948050b, 0x06511d9d, 0x725d4df1],
	20130529: [0x023a6c87, 0x14bf1f1e, 0x5cc70cc9],
	20130605: [0x646e08d9, 0x5f153ab5, 0x61b509b5],
	20130612: [0x6d166f66, 0x3c000fcf, 0x295b0fcb],
	20130618: [0x434115de, 0x34a10fe9, 0x6791428e],
	20130626: [0x38f453ef, 0x6a040fd8, 0x65bd6668],
	20130703: [0x4ff90e23, 0x0f1432f2, 0x4cfa1eda],
	20130710: [0x4a9c4237, 0x4ccf3f8f, 0x458f758f],
	20130717: [0x5ee5520c, 0x5f9e00cf, 0x2bed4f91],
	20130724: [0x3c243bf5, 0x42cc4e2f, 0x02106ec6],
	20130731: [0x1e9d11a6, 0x21a232b8, 0x6a9e02b7],
	20130807: [0x7e241de0, 0x5e805580, 0x3d807d80],
	20130814: [0x23a23148, 0x0c41420e, 0x53785ad7],
	20130821: [0x51673f38, 0x01663512, 0x5cff0b3d],
	20130828: [0x02ef7a9a, 0x4882042f, 0x76796678],
	20130904: [0x41af20c5, 0x0997799e, 0x4ae803a0],
	20130911: [0x232b3f47, 0x0ad0515f, 0x1ca31828],
	20130917: [0x5c9164c5, 0x32b62f83, 0x52864548],
	20130925: [0x4b9c279a, 0x0c7849c4, 0x72a77646],
	20131002: [0x63a466f7, 0x635362f3, 0x41f369f3],
	20131008: [0x64924aad, 0x08ca0445, 0x1cbc36de],
	20131016: [0x33ad7a93, 0x720c7c49, 0x12c4205a],
	20131023: [0x02ef6163, 0x2b774814, 0x58ec3036],
	20131030: [0x4a6a3eff, 0x7e2d5237, 0x01ca019e],
	20131106: [0x143e528f, 0x5ca05899, 0x44b85b23],
	20131107: [0x143e528f, 0x5ca05899, 0x44b85b23],
	20131108: [0x143e528f, 0x5ca05899, 0x44b85b23],
	20131113: [0x44ea14cd, 0x49311c88, 0x40c86c31],
	20131120: [0x541e5172, 0x1b1d30a0, 0x28aa7ce5],
	20131127: [0x21426a48, 0x5c505d6a, 0x046d06ad],
	20131204: [0x792760b2, 0x5af45387, 0x36165603],
	20131211: [0x55b0394e, 0x4d341ff2, 0x60bc1dc3],
	20131218: [0x6a596301, 0x76866d0e, 0x32294a45],
	20131223: [0x631c511c, 0x111c111c, 0x111c111c],
	20131230: [0x611b7097, 0x01f957a1, 0x768a0fcb],
	20140108: [0x4a1e26f2, 0x231e7efe, 0x61fe19fe],
	20140115: [0x63224335, 0x0f3a1f27, 0x6d217b24],
	20140122: [0x6123177b, 0x05b42c99, 0x71702594],
	20140129: [0x2e52163c, 0x605e518b, 0x3c7a62cb],
	20140205: [0x63dc7bdc, 0x7bdc7bdc, 0x7bdc7bdc],
	20140212: [0x46837074, 0x65292e89, 0x77237f9c],
	20140219: [0x4e3c5327, 0x3a6b5469, 0x2ce36aed],
	20140226: [0x36d71056, 0x52122f5e, 0x6ff76e99],
	20140305: [0x116763f2, 0x41117dac, 0x7fd13c45],
	20140312: [0x48911e4e, 0x58cb2eb3, 0x05232619],
	20140319: [0x3da44383, 0x1abb165f, 0x5b6846b9],
	20140326: [0x68e72af6, 0x27db4c3d, 0x348f2677],
	20140402: [0x15d3271c, 0x004d725b, 0x111a3a37],
	20140409: [0x7f6c390f, 0x139c254c, 0x7f25708c],
	20140416: [0x04810281, 0x42814281, 0x42814281],
	20140423: [0x7e0d6b56, 0x74673cd3, 0x2eba4940],
	20140430: [0x400145d8, 0x3fe50155, 0x11624f70],
	20140508: [0x087e57ec, 0x25224f4a, 0x024f12c6],
	20140514: [0x4be46730, 0x047926e0, 0x37773bbb],
	20140521: [0x14ed2d86, 0x17371c33, 0x2d0473c8],
	20140528: [0x579445eb, 0x26734878, 0x7c861628],
	20140605: [0x5abc4223, 0x04dd2636, 0x0d5850e0],
	20140611: [0x4fc83479, 0x3ab04d1f, 0x477b4010],
	20140612: [0x4fc83479, 0x3ab04d1f, 0x477b4010],
	20140613: [0x4fc83479, 0x3ab04d1f, 0x477b4010],
	20140618: [0x2db507bb, 0x11ba12e7, 0x7f447760],
	20140625: [0x09987045, 0x644b1051, 0x1a091cb8],
	20140702: [0x5c4574f4, 0x5d446386, 0x48bd24c9],
	20140709: [0x2c7a6e92, 0x324f1b85, 0x29916fc2],
	20140716: [0x0eb20408, 0x6d6c4292, 0x4f6e4cf3],
	20140723: [0x42a21713, 0x51ce6ead, 0x102f7b0b],
	20140730: [0x63ce4e53, 0x04f969a3, 0x690954db],
	20140806: [0x0d5b69ac, 0x3c001f20, 0x0c201420],
	20140813: [0x7ad51e0a, 0x28c72c46, 0x210205bd],
	20140814: [0x7ad51e0a, 0x28c72c46, 0x210205bd],
	20140820: [0x374f15d0, 0x64c87dec, 0x65ce2a41],
	20140827: [0x53814ca2, 0x27de193e, 0x503e683e],
	20140903: [0x2f386f34, 0x0f935365, 0x76a43888],
	20140917: [0x180118ea, 0x440134cf, 0x3a99179d],
	20140924: [0x6f5222d8, 0x593b798c, 0x4cbd655e],
	20141001: [0x6d882c11, 0x7df959e2, 0x4f3f60e8],
	20141008: [0x754365b3, 0x36b326b3, 0x26b326b3],
	20141015: [0x2dff467c, 0x444b37ee, 0x2c1b634f],
	20141016: [0x2dff467c, 0x444b37ee, 0x2c1b634f],
	20141022: [0x290551ea, 0x2b952c75, 0x2d67669b],
	20141029: [0x1afd581d, 0x2e1d4e1d, 0x4e1d4e1d],
	20141105: [0x7f310819, 0x5ff45401, 0x2d303dd9],
	20141112: [0x430c0c27, 0x067153cf, 0x5e5439a9],
	20141119: [0x7a7e7ede, 0x24eb02e3, 0x71603607],
	20141126: [0x01e14c42, 0x56d73044, 0x4b3278df],
	20141203: [0x66cb52e4, 0x1eb84093, 0x33563e18],
	20141210: [0x0b0b1dd3, 0x26ef1797, 0x4f40370b],
	20141217: [0x01ab478c, 0x0fde58f2, 0x1dac7303],
	20141223: [0x2e8936e6, 0x34463c46, 0x67cd3885],
	20141224: [0x2e8936e6, 0x34463c46, 0x67cd3885],
	20141231: [0x154c347e, 0x54b26512, 0x52126a12],
	20150107: [0x6c494a14, 0x4ddb6427, 0x3e6d7b65],
	20150114: [0x21c96102, 0x13142934, 0x1abf4ea3],
	20150121: [0x0b9d2af5, 0x658a3346, 0x379e3654],
	20150128: [0x77ca2d55, 0x28b608f0, 0x75b47957],
	20150129: [0x77ca2d55, 0x28b608f0, 0x75b47957],
	20150130: [0x77ca2d55, 0x28b608f0, 0x75b47957],
	20150204: [0x134529db, 0x5b4f6cef, 0x29ef11ef],
	20150211: [0x33911a25, 0x1e6945fd, 0x7385623a],
	20150217: [0x731b731b, 0x731b731b, 0x731b731b],
	20150225: [0x57fd4b7b, 0x19cc16fb, 0x0d255d72],
	20150226: [0x57fd4b7b, 0x19cc16fb, 0x0d255d72],
	20150304: [0x1a657b1c, 0x7e1806e7, 0x55396a5c],
	20150311: [0x48c45d97, 0x06ce09b0, 0x5836642f],
	20150318: [0x1b3738e7, 0x0ad4238f, 0x7d252a1f],
	20150325: [0x68f62b8c, 0x337c3468, 0x38fc0ac7],
	20150401: [0x207f3a08, 0x57e6160c, 0x02a60382],
	20150408: [0x39812c9d, 0x23da516e, 0x59a33dd2],
	20150415: [0x7ec44f6a, 0x7de57139, 0x60da5436],
	20150422: [0x10d22ce2, 0x69e279e2, 0x79e279e2],
	20150429: [0x2bf61a71, 0x565d5ddf, 0x0fb90019],
	20150507: [0x55b54373, 0x58967821, 0x67f41832],
	20150513: [0x62c86d09, 0x75944f17, 0x112c133d],
	20150520: [0x17430238, 0x44de585f, 0x56a40616],
	20150527: [0x35ae7bae, 0x3bae3bae, 0x3bae3bae],
	20150603: [0x1ddd245d, 0x309446e0, 0x58e53f1f],
	20150610: [0x2fc406d3, 0x7b3e32f5, 0x02b80b47],
	20150617: [0x250f7e09, 0x25416076, 0x029a780e],
	20150618: [0x250f7e09, 0x25416076, 0x029a780e],
	20150624: [0x440b0e24, 0x1bea7a4c, 0x2c646784],
	20150701: [0x4dd55f9b, 0x70c67b03, 0x78c60db6],
	20150702: [0x4dd55f9b, 0x70c67b03, 0x78c60db6],
	20150708: [0x451c5e19, 0x5661750b, 0x2f4644ac],
	20150715: [0x1f805483, 0x67745585, 0x7fce189c],
	20150722: [0x41fa53d4, 0x2cf044e2, 0x663a3f1d],
	20150729: [0x08ee40a9, 0x206f3d7f, 0x0ae37339],
	20150805: [0x1c3f243f, 0x243f243f, 0x243f243f],
	20150812: [0x0b6f64a8, 0x5bcc47ec, 0x00ec08ec],
	20150819: [0x1a2400e0, 0x736e5686, 0x10f315d5],
	20150826: [0x77883c56, 0x1829359f, 0x0de635b6],
	20150902: [0x4edb18c1, 0x6b9355ba, 0x38aa6239],
	20150909: [0x19ab2bf0, 0x04754299, 0x48770736],
	20150916: [0x17f83a19, 0x116944f4, 0x1cc541e9],
	20150923: [0x765742b9, 0x22d61c2f, 0x7da94fb2],
	20151001: [0x5cff4561, 0x32514ad1, 0x06d126d1],
	20151007: [0x3c6447a8, 0x032170d7, 0x6490476c],
	20151014: [0x402728a8, 0x5d0e309f, 0x240018fd],
	20151021: [0x0311104d, 0x46c326d6, 0x00e82720],
	20151022: [0x0311104d, 0x46c326d6, 0x00e82720],
	20151028: [0x45b945b9, 0x45b945b9, 0x45b945b9],
	20151029: [0x45b945b9, 0x45b945b9, 0x45b945b9],
	20151104: [0x4c17382a, 0x7ed174c9, 0x29961e4f],
	20151111: [0x46097c77, 0x5f193871, 0x29140a21],
	20151118: [0x734c3241, 0x6e846f34, 0x731c06d6],
	20151125: [0x237446c0, 0x5efb343a, 0x0edf06c5],
	20151202: [0x4ede52de, 0x52de52de, 0x52de52de],
	20151209: [0x652c5898, 0x7a351fb3, 0x67ea2886],
	20151216: [0x25dd643d, 0x61ac39de, 0x77a8206d],
	20151223: [0x347d68d0, 0x2c705320, 0x7b4a199d],
	20151230: [0x54c51241, 0x33883499, 0x3cda35f0],
	20160106: [0x40520265, 0x33fe26fc, 0x7136294f],
	20160113: [0x18005c4b, 0x19a94a72, 0x73f678ec],
	20160120: [0x51495149, 0x51495149, 0x51495149],
	20160127: [0x6b1e7146, 0x612c47e6, 0x274e56ee],
	20160203: [0x3e1411af, 0x6c744497, 0x7cfa1bde],
	20160211: [0x613813ea, 0x05251dab, 0x1fd35e33],
	20160217: [0x25895a8e, 0x09421c19, 0x763a2d7a],
	20160224: [0x7088019a, 0x13471f02, 0x42356a7d],
	20160302: [0x7b4441b9, 0x5bbc63af, 0x45da0e71],
	20160309: [0x21587520, 0x353a7706, 0x1b722b25],
	20160316: [0x62363e36, 0x3e363e36, 0x3e363e36],
	20160318: [0x62363e36, 0x3e363e36, 0x3e363e36],
	20160323: [0x73e35a83, 0x62142fa8, 0x12ba36bd],
	20160330: [0x02050940, 0x545336ff, 0x7e7d4902],
	20160406: [0x568611ea, 0x32457d8d, 0x2b020477],
	20160414: [0x31bd479a, 0x40c61398, 0x397c1a80],
	20160420: [0x67d2163a, 0x3068215b, 0x4835474d],
	20160427: [0x12dc378e, 0x4e3e7ebe, 0x0abe2abe],
	20160504: [0x09e0544c, 0x0231251d, 0x2f4e195f],
	20160511: [0x3c666fe2, 0x27e84e3e, 0x53e11ba5],
	20160518: [0x57db7ca1, 0x1fea1629, 0x26dd244d],
	20160525: [0x485c45b6, 0x47dc6192, 0x76b34a36],
	20160526: [0x485c45b6, 0x47dc6192, 0x76b34a36],
	20160601: [0x3dad32c4, 0x59f001be, 0x73f65e56],
	20160608: [0x11d74609, 0x77c43e8a, 0x44290f53],
	20160609: [0x11d74609, 0x77c43e8a, 0x44290f53],
	20160615: [0x062c5c26, 0x6cf47e82, 0x4dd53480],
	20160622: [0x426548ab, 0x5c0f5dd4, 0x03022710],
	20160629: [0x0df31ccc, 0x54281606, 0x5c4c6855],
	20160630: [0x0df31ccc, 0x54281606, 0x5c4c6855],
	20160706: [0x33a766d0, 0x743f04f8, 0x0fa0276c],
	20160713: [0x714f2495, 0x7ddc6f32, 0x3fd8533d],
	20160720: [0x4f8a19c0, 0x2d8e085c, 0x37bb67d6],
	20160727: [0x3c6952ab, 0x26e4077f, 0x37e25df7],
	20160803: [0x67f438c2, 0x512a4eb7, 0x2d353182],
	20160810: [0x2f252886, 0x242234a2, 0x48bc5032],
	20160817: [0x675e6900, 0x3f8e1d16, 0x58d650e5],
	20160824: [0x2fa92fa9, 0x2fa92fa9, 0x2fa92fa9],
	20160831: [0x564e13b0, 0x7f680549, 0x382d273b],
	20160907: [0x32e5237d, 0x57bd4dbd, 0x5dbd5dbd],
	20160913: [0x7c79748f, 0x1aa03b1d, 0x6eac4747],
	20160921: [0x11cd15cd, 0x15cd15cd, 0x15cd15cd],
	20160928: [0x2f8c67f5, 0x22d42c38, 0x57513774],
	20161005: [0x5bae21f8, 0x021e2ffc, 0x3beb7c31],
	20161012: [0x5e2311f2, 0x14fd012c, 0x76eb64f6],
	20161019: [0x34882f11, 0x7c870e70, 0x7e61350d],
	20161026: [0x2cb86ae6, 0x7d12660e, 0x1b004deb],
	20161102: [0x76725c17, 0x72fe4ec1, 0x07a91bfd],
	20161103: [0x76725c17, 0x72fe4ec1, 0x07a91bfd],
	20161109: [0x0a5277c0, 0x2db17506, 0x0e8f26da],
	20161116: [0x780c5c3f, 0x15e92272, 0x2ba770c5],
	20161123: [0x66ff559f, 0x00d3535b, 0x236246f7],
	20161130: [0x2ed80296, 0x0d837373, 0x20266f9a],
	20161207: [0x52d267aa, 0x4fe42156, 0x1292153e],
	20161214: [0x4dde217b, 0x07863ae0, 0x5b591656],
	20161221: [0x69cb4f56, 0x793c165e, 0x673a2354],
	20161228: [0x09366971, 0x005672f1, 0x6f3712ae],
	20170104: [0x44416bc3, 0x6c8d1817, 0x072d75d5],
	20170111: [0x19b637f9, 0x0e9c378a, 0x41673186],
	20170118: [0x456b36eb, 0x15eb34b0, 0x18c42e43],
	20170125: [0x066e04fe, 0x3004224a, 0x04ff0458],
	20170201: [0x2011228e, 0x00453005, 0x628e7f0a],
	20170208: [0x6a764e5f, 0x0609570d, 0x28ae07fa],
	20170215: [0x50c01315, 0x51012a42, 0x679e16c3],
	20170222: [0x5a242f2f, 0x6c556187, 0x73c022cb],
	20170228: [0x771d4f2b, 0x20ef1f4c, 0x0d5135c8],
	20170308: [0x653470a9, 0x6b316a71, 0x5c712c71],
	20170315: [0x399a0856, 0x56642a94, 0x7f77157d],
	20170322: [0x2050167b, 0x01731233, 0x40337033],
	20170329: [0x18b31a80, 0x1b0b1d56, 0x16857d6a],
	20170405: [0x1fde7dac, 0x2f9f5b63, 0x3f2062af],
	20170412: [0x39223393, 0x5c847779, 0x10217985],
	20170419: [0x1f8f4b3f, 0x2e481f03, 0x39ed4178],
	20170426: [0x167642a7, 0x1dec3d26, 0x6d046d4c],
	20170502: [0x05224194, 0x466d4204, 0x31f02ee0],
	20170517: [0x2cc4749a, 0x1fa954dc, 0x72276857],
	20170524: [0x0b4e03a6, 0x2b93427c, 0x583d4477],
	20170531: [0x03fa5a97, 0x20b802d5, 0x339f1977],
	20170607: [0x50564acd, 0x79ca4e15, 0x405f4894],
	20170614: [0x5ed10a48, 0x667f4301, 0x2e5d761f],
	20170621: [0x155f34ec, 0x2d943fa9, 0x3d9170eb],
	20170628: [0x04691c86, 0x43c210e2, 0x2fe277e2],
	20170705: [0x7eb000ae, 0x02fb1dbc, 0x5cb131e6],
	20170712: [0x2c3c202c, 0x3f2c2f2c, 0x2f2c2f2c],
	20170719: [0x46465c88, 0x10116f66, 0x200866f9],
	20170726: [0x102f23db, 0x7e767751, 0x3bc172ef],
	20170801: [0x26b52a7f, 0x5377619d, 0x4f580ac4],
	20170809: [0x452156cb, 0x71442624, 0x2ee66d1c],
	20170816: [0x78914673, 0x3f8b7634, 0x55b814bc],
	20170823: [0x22677205, 0x393d1002, 0x58dc6bb4],
	20170830: [0x1d49592b, 0x00970c17, 0x1e640103],
	20170906: [0x7def7677, 0x351f36e6, 0x52303485],
	20170913: [0x7a645935, 0x1da05062, 0x5a7a4c43],
	20170920: [0x53024da5, 0x04ec212d, 0x0bf87cd4],
	20170927: [0x15624100, 0x0ce1463e, 0x0e5d6534],
	20171002: [0x15e1716c, 0x4e765b63, 0x357d2370],
	20171011: [0x4f121b3e, 0x12670e17, 0x19896c11],
	20171018: [0x2caa109c, 0x158c1ec2, 0x7a5e58f3],
	20171025: [0x165c565c, 0x565c565c, 0x565c565c],
	20171101: [0x7056317f, 0x7eee0589, 0x02672373],
	20171108: [0x03695685, 0x7fac12ce, 0x182f7a7b],
	20171115: [0x23b97a3b, 0x34610993, 0x2892070e],
	20171122: [0x03221b0e, 0x73ab7a5f, 0x0dd80fd4],
	20171129: [0x581b77a7, 0x62f74d7a, 0x4f102173],
	20171206: [0x39d54bd3, 0x577a0c21, 0x4c1c316e],
	20171213: [0x44e41107, 0x3b126921, 0x00e06aac],
	20171220: [0x6efe009a, 0x440b7bfa, 0x052339c8],
	20171227: [0x257a2f6e, 0x51140eee, 0x00fa4452],
	20180103: [0x348f4bd7, 0x7a425a54, 0x628f589a],
	20180117: [0x21f477f4, 0x37f437f4, 0x37f437f4],
	20180124: [0x7eaa1ce0, 0x415d1cfd, 0x4c8f19fa],
	20180131: [0x7eaa1ce0, 0x415d1cfd, 0x4c8f19fa],
	20180207: [0x45aa1b44, 0x20e716b7, 0x5388105c],
	20180213: [0x189d69b2, 0x43b85ead, 0x2b7a687e],
	20180221: [0x6e2f6233, 0x193b0a66, 0x0d1d2ca5],
	20180307: [0x47da10eb, 0x4b922ccf, 0x765c5055],
	20180309: [0x47da10eb, 0x4b922ccf, 0x765c5055],
	20180314: [0x2ff07149, 0x00596ea3, 0x2b853026],
};

/**
 * Multiply two integers - because javascript precision sux
 *
 * @param {number} a
 * @param {number} b
 *
 * @returns a * b
 */
var imul;

// Check for support and kick out Safari bug
if (Math.imul && Math.imul(0xffffffff, 5) === -5) {
	imul = Math.imul;
} else {
	imul = function imul(a, b) {
		var ah = (a >>> 16) & 0xffff;
		var al = a & 0xffff;
		var bh = (b >>> 16) & 0xffff;
		var bl = b & 0xffff;
		// the shift by 0 fixes the sign on the high part
		// the final |0 converts the unsigned value into a signed value
		return (al * bl + (((ah * bl + al * bh) << 16) >>> 0)) | 0;
	};
}

/**
 * Initialize to get keys for packet encryption
 */
function Init() {
	var packetKeys;

	_available = false;
	packetKeys = Configs.get("packetKeys");

	if (!packetKeys) {
		return;
	}

	// Custom keys
	if (packetKeys instanceof Array) {
		_available = true;
		_keys.set(packetKeys);
	} else {
		var date, key;

		// Define a date or use the defined packetver ?
		if (typeof packetKeys === "number") {
			date = packetKeys;
		} else {
			date = Configs.get("packetver");
		}

		// Get the available keys
		for (key in KeysTable) {
			if (date >= key) {
				_available = true;
				_keys.set(KeysTable[key]);
			}
		}
	}

	if (_available) {
		console.log(
			"%c[PACKETCRYPT] Encrypt sent packets using keys",
			"color:#007000",
			_keys
		);
	}
}

/**
 * Encrypt header using keys
 *
 * @param {DataView} view
 */
function Process(view) {
	if (_available) {
		var cmd = view.getInt16(0, true);

		// Update key
		_keys[0] = (imul(_keys[0], _keys[1]) + _keys[2]) & 0xffffffff;

		// Encrypt header
		cmd ^= (_keys[0] >> 16) & 0x7fff;

		view.setInt16(0, cmd, true);
	}
}

/**
 * Export
 */
export default {
	init: Init,
	process: Process,
};
